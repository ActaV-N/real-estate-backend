let Koa,serve,KoaBody,cors,ApolloServer,mongoose,resolvers,typeDefs;_08c‍.w("koa",[["default",["Koa"],function(v){Koa=v}]]);_08c‍.w("koa-static",[["default",["serve"],function(v){serve=v}]]);_08c‍.w("koa-bodyparser",[["default",["KoaBody"],function(v){KoaBody=v}]]);_08c‍.w("cors",[["default",["cors"],function(v){cors=v}]]);_08c‍.w("apollo-server-koa",[["ApolloServer",["ApolloServer"],function(v){ApolloServer=v}]]);_08c‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_08c‍.w("./graphql",[["resolvers",["resolvers"],function(v){resolvers=v}],["typeDefs",["typeDefs"],function(v){typeDefs=v}]]);require('dotenv').config();











const app = new Koa();
const PORT = process.env.PORT || 4000;

app.use(KoaBody());
app.proxy = true;

app.use(serve('.'));

// Database connection
const db = mongoose.connection;
mongoose.connect(process.env.MONGO_URI, {
	useNewUrlParser: true,
	useUnifiedTopology: true,
	useFindAndModify: false,
});
db.on('connected', () => console.log('Database connected'));
db.on('error', (err) => _08c‍.g.console.log(err));

const server = new ApolloServer({
	typeDefs,
	resolvers,
	context: ({ ctx }) => {
		const token = ctx.cookies.get('access_token');
		return { ctx, token };
	},
});
server.applyMiddleware({
	app,
	cors: { credentials: true, origin: 'http://localhost:3000' }, // TODO: change to https://weasy.netlify.com
});

app.listen(PORT, () => {
	console.log(`🚀  Server ready at localhost:${PORT}`);
});
