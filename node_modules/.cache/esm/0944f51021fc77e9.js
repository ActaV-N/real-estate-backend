let mongoose,SectorSchema,LocationSchema;_21f‍.x([["default",()=>_21f‍.o]]);_21f‍.w("mongoose",[["default",["mongoose"],function(v){mongoose=v}]]);_21f‍.w("./Sector",[["SectorSchema",["SectorSchema"],function(v){SectorSchema=v}]]);_21f‍.w("./Location",[["LocationSchema",["LocationSchema"],function(v){LocationSchema=v}]]);



const { Schema, model } = mongoose;

const BuildingSchema = new Schema({
	creationDate: {
		type: Date,
		default: new Date(),
	},
	buildingInfo: {
		image: String,
		name: String,

		layer: Number,
		number: Number,

		saleArea: Number,
		realArea: Number,

		sectors: {
			basic: String,
			detail: String,
		},

		location: LocationSchema,
	},
	dealInfo: {
		trade: {
			price: Number,
			deposit: Number,
			monthly: Number,
			totalPrice: Number,
		},
		lease: {
			price: Number,
			deposit: Number,
			monthly: Number,
		},
		rights: Number,
	},
	officialsInfo: {
		owner: String,
		ownerPhone: String,
		lessee: String,
		lesseePhone: String,
	},
	history: [
		{
			updateDate: {
				type: Date,
			},
			dealInfo: {
				trade: {
					price: Number,
					deposit: Number,
					monthly: Number,
					totalPrice: Number,
				},
				lease: {
					price: Number,
					deposit: Number,
					monthly: Number,
				},
				rights: Number,
			},
		},
	],
	traffic: [
		{
			updateDate: {
				type: Date,
			},
			percentage: Number,
		},
	],
});

BuildingSchema.pre('save', function (next) {
	const { trade } = this.dealInfo;
	if (trade) {
		trade.totalPrice = trade.price * this.buildingInfo.saleArea;
	}
	next();
});

_21f‍.d(model('building', BuildingSchema));
